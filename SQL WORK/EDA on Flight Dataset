
-- Q1  find the month with most number of flights
SELECT MONTHNAME(DATE_OF_JOURNEY_2) MONTH_NAME ,COUNT(*) NO_OF_FLIGHTS
FROM flight_dataset
GROUP BY MONTHNAME(DATE_OF_JOURNEY_2)
ORDER BY NO_OF_FLIGHTS DESC;

-- Q2 WHICH WEEK DAY HAS MOST COSTLY FLIGHTS /* WEEKDAY RETURNS DAY NUMBER IN WEEK AND DAYNAME RETURN NAME OF DAY*/
SELECT DAYNAME(DATE_OF_JOURNEY_2) MONTH_NAME ,ROUND(AVG(Price)) PRICE
FROM flight_dataset
GROUP BY DAYNAME(DATE_OF_JOURNEY_2)
ORDER BY PRICE DESC;

-- Q3 FIND LIST OF ALL FLIGHTS THAT DEPART BETWEEN  10 AM AND 2 PM FROM BANGALORE TO DELHI
SELECT * FROM flight_dataset
WHERE Source='Banglore' AND Destination='Delhi' AND Dep_Time>'10:00' AND Dep_Time<'14:00';

-- Q4 FIND NUMBER OF INDIGO FLIGHTS EVERY MONTH

SELECT MONTHNAME(DATE_OF_JOURNEY_2) MONTH_NAME ,COUNT(*) NO_OF_FLIGHTS
FROM flight_dataset
WHERE Airline='IndiGo'
GROUP BY MONTHNAME(DATE_OF_JOURNEY_2)
ORDER BY NO_OF_FLIGHTS DESC;

-- Q5 FIND LIST OF ALL FLIGHTS THAT DEPART BETWEEN  10 AM AND 2 PM FROM BANGALORE TO DELHI

SELECT * FROM flight_dataset
WHERE Source='Banglore' AND Destination='Delhi' AND Dep_Time>'10:00' AND Dep_Time<'14:00';

-- Q6 FIND THE NUMBER OF FLIGHTS DEPARTING ON WEEKENDS FROM BANGALORE

SELECT COUNT(*) NUMBER_OF_FLIGHTS FROM flight_dataset
WHERE Source='Banglore' AND DAYNAME(DATE_OF_JOURNEY_2) IN ('Saturday','Sunday');

-- Q7 CALCULATE THE ARRIVAL TIME FOR ALL FLIGHTS BY ADDING A DURATION TO DEPARTURE TIME
SELECT ARRIVAL_TIME
FROM flight_dataset

-- Q8 -- CALCULATE ARRIVAL DATE FOR ALL FILIGHTS

SELECT DATE(ARRIVAL_TIME)
FROM flight_dataset

-- Q9 FIND NUMBER OF FLIGHTS WHICH TRAVELS IN A MULTIPLE DATES MTLB JINKA DEPART DATE != ARRIVAL DATE

SELECT COUNT(*) NO_OF_FLIGHTS
FROM flight_dataset
WHERE DATE(DEPARTURE_TIME) != DATE(ARRIVAL_TIME);

-- Q10 CALCULATE AVG DURATION OF FLIGHTS BETWEEN ALL CITY PAIRS
SELECT Source,Destination,TIME_FORMAT(SEC_TO_TIME(ROUND(AVG(DURATIONMIN))*60),'%Hh:%im') AVG_TIME
FROM flight_dataset
GROUP BY Source,Destination;

-- Q11 FIND ALL THE FLIGHTS WHICH DEPARTED BEFORE MIDNIGHT BUT ARRIVED THEIR DESTINATION AFTER MIDNIGHT HAVING ONLY 0 STOPS.
SELECT * FROM flight_dataset
WHERE TIME(DEPARTURE_TIME)>'23:59:59' AND TIME(ARRIVAL_TIME)< '23:59:59';

-- Q12 FIND QUATER WISE NUMBER OF FLIGHTS FOR EACH AIRLINE

SELECT Airline,QUARTER(DATE_OF_JOURNEY_2) QUATER,COUNT(*) NO_OF_FLIGHTS FROM flight_dataset
GROUP BY Airline,QUARTER(DATE_OF_JOURNEY_2)
ORDER BY NO_OF_FLIGHTS DESC;

-- Q13 -- FIND THE LONGEST FLIGHT DISTANCE BWTEEN CITIES IN TERMS OF TIME IN INDIA

SELECT Source,Destination,TIME_FORMAT(SEC_TO_TIME(AVG(DURATIONMIN)*60),'%hh:%im') AVG_DURATION FROM flight_dataset
GROUP BY Source,Destination
ORDER BY AVG_DURATION DESC;

-- Q14 AVERAGE TIME DURATION FOR FLIGHTS HAVING 1STOP AND MORE THAN 1 STOP


WITH TEMP AS (
SELECT *,(CASE WHEN Total_Stops='1 stop' THEN '1' ELSE '1+' END) NUMBER_OF_STOPS FROM flight_dataset
WHERE Total_Stops!='non-stops'
)

SELECT NUMBER_OF_STOPS,TIME_FORMAT(SEC_TO_TIME(ROUND(AVG(DURATIONMIN))*60),'%Hh:%im') AVG_TIME FROM TEMP
GROUP BY NUMBER_OF_STOPS
ORDER BY AVG_TIME DESC


-- Q15 FIND ALL CITIES PAIR HAVING AVG TIME DURATION > 3 HOURS

SELECT Source,Destination FROM flight_dataset
GROUP BY Source,Destination
HAVING AVG(DURATIONMIN)>180;

-- Q16 MAKE A WEEKDAY VS TIMEGRID SHOWING AVG PRICE OF FLIGHTS FROM BANGALORE TO DELHI KIND OF PIVOT TABLE 

-- STEP 1 : FILTER THE DATA FROM BANGLORE TO DELHI
SELECT * FROM flight_dataset
WHERE Source='Banglore' AND Destination='Delhi';

-- STEP 2 : NOW GROUP BY ON DAYNAME
SELECT DAYOFWEEK(DATE_OF_JOURNEY_2) DAY_NUM,DAYNAME(DATE_OF_JOURNEY_2) WEEKDAYS FROM flight_dataset
WHERE Source='Banglore' AND Destination='Delhi'
GROUP BY DAYOFWEEK(DATE_OF_JOURNEY_2),DAYNAME(DATE_OF_JOURNEY_2)
ORDER BY DAYOFWEEK(DATE_OF_JOURNEY_2) ASC;

-- STEP 3 CREATE TIME RANGE LIKE 0-6AM,6-12PM,12-18PM,18-00AM AND FOR EACH COMBO CAL AVG(PRICE)


SELECT DAYOFWEEK(DATE_OF_JOURNEY_2) DAY_NUM,DAYNAME(DATE_OF_JOURNEY_2) WEEKDAYS,
ROUND(AVG(CASE WHEN HOUR(DEPARTURE_TIME) BETWEEN 0 AND 5 THEN Price ELSE NULL END)) '12AM-6AM',
ROUND(AVG(CASE WHEN HOUR(DEPARTURE_TIME) BETWEEN 6 AND 11 THEN Price ELSE NULL END )) '6AM-12PM', -- BETWEEN DONO NUMBER KO INCLUDE KARTA HAI
ROUND(AVG(CASE WHEN HOUR(DEPARTURE_TIME) BETWEEN 12 AND 17 THEN Price ELSE NULL END)) '12PM-18PM',
ROUND(AVG(CASE WHEN HOUR(DEPARTURE_TIME) BETWEEN 18 AND 23 THEN Price ELSE NULL END)) '18PM-12AM'
 FROM flight_dataset
WHERE Source='Banglore' AND Destination='Delhi'
GROUP BY DAYOFWEEK(DATE_OF_JOURNEY_2),DAYNAME(DATE_OF_JOURNEY_2)
ORDER BY DAYOFWEEK(DATE_OF_JOURNEY_2) ASC;

-- Q16 MAKE A WEEKDAY VS TIMEGRID SHOWING FREQUENCY OF FLIGHTS FROM BANGALORE TO DELHI KIND OF PIVOT TABLE 


SELECT DAYOFWEEK(DATE_OF_JOURNEY_2) DAY_NUM,DAYNAME(DATE_OF_JOURNEY_2) WEEKDAYS,
SUM(CASE WHEN HOUR(DEPARTURE_TIME) BETWEEN 0 AND 5 THEN 1 ELSE 0 END) '12AM-6AM',
SUM(CASE WHEN HOUR(DEPARTURE_TIME) BETWEEN 6 AND 11 THEN 1 ELSE 0 END) '6AM-12PM', -- BETWEEN DONO NUMBER KO INCLUDE KARTA HAI
SUM(CASE WHEN HOUR(DEPARTURE_TIME) BETWEEN 12 AND 17 THEN 1 ELSE 0 END) '12PM-18PM',
SUM(CASE WHEN HOUR(DEPARTURE_TIME) BETWEEN 18 AND 23 THEN 1 ELSE 0 END) '18PM-12AM'
 FROM flight_dataset
WHERE Source='Banglore' AND Destination='Delhi'
GROUP BY DAYOFWEEK(DATE_OF_JOURNEY_2),DAYNAME(DATE_OF_JOURNEY_2)
ORDER BY DAYOFWEEK(DATE_OF_JOURNEY_2) ASC

